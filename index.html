<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitter MVP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: #000;
            color: #fff;
            line-height: 1.4;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            border-left: 1px solid #333;
            border-right: 1px solid #333;
        }

        .header {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid #333;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1d9bf0;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn {
            background: #1d9bf0;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background: #1a8cd8;
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid #333;
            color: #1d9bf0;
        }

        .btn-secondary:hover {
            background: rgba(29, 155, 240, 0.1);
        }

        .btn-small {
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
        }

        .compose-section {
            border-bottom: 1px solid #333;
            padding: 1rem;
        }

        .compose-area {
            display: flex;
            gap: 1rem;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .compose-form {
            flex: 1;
        }

        .tweet-input {
            width: 100%;
            background: transparent;
            border: none;
            color: white;
            font-size: 1.25rem;
            resize: none;
            outline: none;
            min-height: 50px;
            font-family: inherit;
        }

        .tweet-input::placeholder {
            color: #71767b;
        }

        .compose-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .char-count {
            color: #71767b;
            font-size: 0.9rem;
        }

        .char-count.warning {
            color: #ffd400;
        }

        .char-count.error {
            color: #f4212e;
        }

        .tweet {
            border-bottom: 1px solid #333;
            padding: 1rem;
            transition: background-color 0.2s;
        }

        .tweet:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .tweet-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .username {
            font-weight: bold;
        }

        .handle {
            color: #71767b;
        }

        .timestamp {
            color: #71767b;
            font-size: 0.9rem;
        }

        .tweet-content {
            margin-bottom: 1rem;
            white-space: pre-wrap;
        }

        .tweet-actions {
            display: flex;
            justify-content: space-between;
            max-width: 300px;
        }

        .action-btn {
            background: none;
            border: none;
            color: #71767b;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: rgba(29, 155, 240, 0.1);
            color: #1d9bf0;
        }

        .action-btn.liked {
            color: #f91880;
        }

        .action-btn.liked:hover {
            background: rgba(249, 24, 128, 0.1);
        }

        .action-btn.retweeted {
            color: #00ba7c;
        }

        .action-btn.retweeted:hover {
            background: rgba(0, 186, 124, 0.1);
        }

        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .auth-form {
            background: #000;
            border: 1px solid #333;
            border-radius: 1rem;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
        }

        .auth-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-input {
            width: 100%;
            background: transparent;
            border: 1px solid #333;
            border-radius: 0.5rem;
            padding: 1rem;
            color: white;
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: #1d9bf0;
        }

        .auth-switch {
            text-align: center;
            margin-top: 1rem;
            color: #71767b;
        }

        .auth-link {
            color: #1d9bf0;
            cursor: pointer;
            text-decoration: none;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        .profile-section {
            border-bottom: 1px solid #333;
            padding: 1rem;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .profile-info h2 {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .profile-stats {
            display: flex;
            gap: 1rem;
            color: #71767b;
            font-size: 0.9rem;
        }

        .nav-tabs {
            display: flex;
            border-bottom: 1px solid #333;
        }

        .nav-tab {
            background: none;
            border: none;
            color: #71767b;
            padding: 1rem;
            cursor: pointer;
            flex: 1;
            text-align: center;
            font-weight: bold;
            border-bottom: 2px solid transparent;
        }

        .nav-tab.active {
            color: white;
            border-bottom-color: #1d9bf0;
        }

        .empty-state {
            padding: 2rem;
            text-align: center;
            color: #71767b;
        }

        .hidden {
            display: none;
        }

        .follow-btn {
            padding: 0.25rem 1rem;
            font-size: 0.9rem;
        }

        .profile-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #333;
            cursor: pointer;
        }

        .profile-item:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .retweet-indicator {
            color: #71767b;
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">Twitter</div>
            <div class="user-info">
                <span id="currentUser" class="hidden"></span>
                <button id="logoutBtn" class="btn btn-secondary btn-small hidden">Logout</button>
                <button id="loginBtn" class="btn btn-small">Login</button>
            </div>
        </div>

        <!-- Main Content -->
        <div id="mainContent">
            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="timeline">Timeline</button>
                <button class="nav-tab" data-tab="profile">Profile</button>
                <button class="nav-tab" data-tab="explore">Explore</button>
            </div>

            <!-- Timeline Tab -->
            <div id="timelineTab" class="tab-content">
                <!-- Compose Section -->
                <div id="composeSection" class="compose-section hidden">
                    <div class="compose-area">
                        <div class="avatar" id="userAvatar">U</div>
                        <div class="compose-form">
                            <textarea 
                                id="tweetInput" 
                                class="tweet-input" 
                                placeholder="What's happening?"
                                maxlength="280"
                            ></textarea>
                            <div class="compose-actions">
                                <div class="char-count" id="charCount">0/280</div>
                                <button id="tweetBtn" class="btn" disabled>Tweet</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Timeline Feed -->
                <div id="timelineFeed"></div>
            </div>

            <!-- Profile Tab -->
            <div id="profileTab" class="tab-content hidden">
                <div id="profileContent" class="hidden">
                    <div class="profile-section">
                        <div class="profile-header">
                            <div class="profile-info">
                                <h2 id="profileDisplayName"></h2>
                                <div class="handle" id="profileHandle"></div>
                                <div class="profile-stats">
                                    <span><span id="followingCount">0</span> Following</span>
                                    <span><span id="followersCount">0</span> Followers</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="profileTweets"></div>
                </div>
            </div>

            <!-- Explore Tab -->
            <div id="exploreTab" class="tab-content hidden">
                <div id="exploreContent" class="hidden">
                    <div id="usersList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="auth-modal">
        <div class="auth-form">
            <h2 class="auth-title" id="authTitle">Sign in to Twitter</h2>
            <form id="authForm">
                <div class="form-group">
                    <input 
                        type="text" 
                        id="username" 
                        class="form-input" 
                        placeholder="Username" 
                        required
                    >
                </div>
                <div class="form-group" id="displayNameGroup">
                    <input 
                        type="text" 
                        id="displayName" 
                        class="form-input" 
                        placeholder="Display Name"
                    >
                </div>
                <button type="submit" class="btn" style="width: 100%;" id="authSubmit">Sign In</button>
            </form>
            <div class="auth-switch">
                <span id="authSwitchText">Don't have an account?</span>
                <a href="#" class="auth-link" id="authSwitchLink">Sign up</a>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('twitter_users') || '{}');
        let tweets = JSON.parse(localStorage.getItem('twitter_tweets') || '[]');
        let follows = JSON.parse(localStorage.getItem('twitter_follows') || '{}');
        let likes = JSON.parse(localStorage.getItem('twitter_likes') || '{}');
        let retweets = JSON.parse(localStorage.getItem('twitter_retweets') || '{}');
        let isSignUp = false;

        // DOM elements
        const authModal = document.getElementById('authModal');
        const authForm = document.getElementById('authForm');
        const authTitle = document.getElementById('authTitle');
        const authSubmit = document.getElementById('authSubmit');
        const authSwitchText = document.getElementById('authSwitchText');
        const authSwitchLink = document.getElementById('authSwitchLink');
        const displayNameGroup = document.getElementById('displayNameGroup');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const currentUserSpan = document.getElementById('currentUser');
        const composeSection = document.getElementById('composeSection');
        const tweetInput = document.getElementById('tweetInput');
        const tweetBtn = document.getElementById('tweetBtn');
        const charCount = document.getElementById('charCount');
        const timelineFeed = document.getElementById('timelineFeed');
        const userAvatar = document.getElementById('userAvatar');

        // Initialize app
        function init() {
            setupEventListeners();
            checkAuthState();
            updateUI();
        }

        function setupEventListeners() {
            // Auth modal
            authForm.addEventListener('submit', handleAuth);
            authSwitchLink.addEventListener('click', toggleAuthMode);
            loginBtn.addEventListener('click', showAuthModal);
            logoutBtn.addEventListener('click', logout);

            // Tweet composition
            tweetInput.addEventListener('input', updateCharCount);
            tweetBtn.addEventListener('click', postTweet);

            // Tab navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    switchTab(e.target.dataset.tab);
                });
            });

            // Close modal on outside click
            authModal.addEventListener('click', (e) => {
                if (e.target === authModal) {
                    hideAuthModal();
                }
            });
        }

        function checkAuthState() {
            const savedUser = localStorage.getItem('twitter_current_user');
            if (savedUser) {
                currentUser = savedUser;
                showMainContent();
            } else {
                showAuthModal();
            }
        }

        function showAuthModal() {
            authModal.classList.remove('hidden');
            updateAuthModal();
        }

        function hideAuthModal() {
            authModal.classList.add('hidden');
        }

        function updateAuthModal() {
            if (isSignUp) {
                authTitle.textContent = 'Sign up for Twitter';
                authSubmit.textContent = 'Sign Up';
                authSwitchText.textContent = 'Already have an account?';
                authSwitchLink.textContent = 'Sign in';
                displayNameGroup.classList.remove('hidden');
            } else {
                authTitle.textContent = 'Sign in to Twitter';
                authSubmit.textContent = 'Sign In';
                authSwitchText.textContent = "Don't have an account?";
                authSwitchLink.textContent = 'Sign up';
                displayNameGroup.classList.add('hidden');
            }
        }

        function toggleAuthMode(e) {
            e.preventDefault();
            isSignUp = !isSignUp;
            updateAuthModal();
            authForm.reset();
        }

        function handleAuth(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const displayName = document.getElementById('displayName').value.trim();

            if (!username) {
                alert('Username is required');
                return;
            }

            if (isSignUp) {
                if (users[username]) {
                    alert('Username already exists');
                    return;
                }
                if (!displayName) {
                    alert('Display name is required for sign up');
                    return;
                }
                users[username] = {
                    username,
                    displayName,
                    joinDate: new Date().toISOString()
                };
                follows[username] = [];
                saveData();
            } else {
                if (!users[username]) {
                    alert('User not found');
                    return;
                }
            }

            currentUser = username;
            localStorage.setItem('twitter_current_user', currentUser);
            hideAuthModal();
            showMainContent();
            updateUI();
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('twitter_current_user');
            showAuthModal();
            hideMainContent();
        }

        function showMainContent() {
            document.getElementById('mainContent').classList.remove('hidden');
            composeSection.classList.remove('hidden');
            loginBtn.classList.add('hidden');
            logoutBtn.classList.remove('hidden');
            currentUserSpan.classList.remove('hidden');
            currentUserSpan.textContent = `@${currentUser}`;
            userAvatar.textContent = users[currentUser].displayName[0].toUpperCase();
        }

        function hideMainContent() {
            document.getElementById('mainContent').classList.add('hidden');
            composeSection.classList.add('hidden');
            loginBtn.classList.remove('hidden');
            logoutBtn.classList.add('hidden');
            currentUserSpan.classList.add('hidden');
        }

        function updateCharCount() {
            const count = tweetInput.value.length;
            charCount.textContent = `${count}/280`;
            
            if (count > 280) {
                charCount.className = 'char-count error';
                tweetBtn.disabled = true;
            } else if (count > 250) {
                charCount.className = 'char-count warning';
                tweetBtn.disabled = false;
            } else {
                charCount.className = 'char-count';
                tweetBtn.disabled = count === 0;
            }
        }

        function postTweet() {
            const content = tweetInput.value.trim();
            if (!content || content.length > 280) return;

            const tweet = {
                id: Date.now().toString(),
                author: currentUser,
                content,
                timestamp: new Date().toISOString(),
                likes: 0,
                retweets: 0
            };

            tweets.unshift(tweet);
            saveData();
            tweetInput.value = '';
            updateCharCount();
            updateTimeline();
        }

        function updateTimeline() {
            const following = follows[currentUser] || [];
            const relevantTweets = tweets.filter(tweet => 
                tweet.author === currentUser || following.includes(tweet.author)
            );

            timelineFeed.innerHTML = '';
            
            if (relevantTweets.length === 0) {
                timelineFeed.innerHTML = '<div class="empty-state">No tweets to show. Follow some users or post your first tweet!</div>';
                return;
            }

            relevantTweets.forEach(tweet => {
                const tweetElement = createTweetElement(tweet);
                timelineFeed.appendChild(tweetElement);
            });
        }

        function createTweetElement(tweet, isRetweet = false, retweetedBy = null) {
            const tweetDiv = document.createElement('div');
            tweetDiv.className = 'tweet';
            
            const user = users[tweet.author];
            const isLiked = likes[currentUser]?.includes(tweet.id) || false;
            const isRetweeted = retweets[currentUser]?.includes(tweet.id) || false;

            let retweetIndicator = '';
            if (isRetweet && retweetedBy) {
                retweetIndicator = `
                    <div class="retweet-indicator">
                        <span>🔄</span> ${users[retweetedBy]?.displayName || retweetedBy} retweeted
                    </div>
                `;
            }

            tweetDiv.innerHTML = `
                ${retweetIndicator}
                <div class="tweet-header">
                    <div class="avatar">${user.displayName[0].toUpperCase()}</div>
                    <span class="username">${user.displayName}</span>
                    <span class="handle">@${user.username}</span>
                    <span class="timestamp">• ${formatTimestamp(tweet.timestamp)}</span>
                </div>
                <div class="tweet-content">${tweet.content}</div>
                <div class="tweet-actions">
                    <button class="action-btn like-btn ${isLiked ? 'liked' : ''}" data-tweet-id="${tweet.id}">
                        <span>${isLiked ? '❤️' : '🤍'}</span>
                        <span>${tweet.likes || 0}</span>
                    </button>
                    <button class="action-btn retweet-btn ${isRetweeted ? 'retweeted' : ''}" data-tweet-id="${tweet.id}">
                        <span>🔄</span>
                        <span>${tweet.retweets || 0}</span>
                    </button>
                </div>
            `;

            // Add event listeners
            const likeBtn = tweetDiv.querySelector('.like-btn');
            const retweetBtn = tweetDiv.querySelector('.retweet-btn');

            likeBtn.addEventListener('click', () => toggleLike(tweet.id));
            retweetBtn.addEventListener('click', () => toggleRetweet(tweet.id));

            return tweetDiv;
        }

        function toggleLike(tweetId) {
            if (!likes[currentUser]) likes[currentUser] = [];
            
            const likeIndex = likes[currentUser].indexOf(tweetId);
            const tweet = tweets.find(t => t.id === tweetId);
            
            if (likeIndex > -1) {
                likes[currentUser].splice(likeIndex, 1);
                tweet.likes = Math.max(0, (tweet.likes || 0) - 1);
            } else {
                likes[currentUser].push(tweetId);
                tweet.likes = (tweet.likes || 0) + 1;
            }
            
            saveData();
            updateTimeline();
        }

        function toggleRetweet(tweetId) {
            if (!retweets[currentUser]) retweets[currentUser] = [];
            
            const retweetIndex = retweets[currentUser].indexOf(tweetId);
            const tweet = tweets.find(t => t.id === tweetId);
            
            if (retweetIndex > -1) {
                retweets[currentUser].splice(retweetIndex, 1);
                tweet.retweets = Math.max(0, (tweet.retweets || 0) - 1);
            } else {
                retweets[currentUser].push(tweetId);
                tweet.retweets = (tweet.retweets || 0) + 1;
            }
            
            saveData();
            updateTimeline();
        }

        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'now';
            if (minutes < 60) return `${minutes}m`;
            if (hours < 24) return `${hours}h`;
            return `${days}d`;
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Show/hide tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tabName}Tab`).classList.remove('hidden');

            // Load tab-specific content
            if (tabName === 'timeline') {
                updateTimeline();
            } else if (tabName === 'profile') {
                updateProfile();
            } else if (tabName === 'explore') {
                updateExplore();
            }
        }

        function updateProfile() {
            const profileContent = document.getElementById('profileContent');
            if (!currentUser) {
                profileContent.classList.add('hidden');
                return;
            }

            profileContent.classList.remove('hidden');
            
            const user = users[currentUser];
            document.getElementById('profileDisplayName').textContent = user.displayName;
            document.getElementById('profileHandle').textContent = `@${user.username}`;
            
            const followingCount = follows[currentUser]?.length || 0;
            const followersCount = Object.values(follows).filter(f => f.includes(currentUser)).length;
            
            document.getElementById('followingCount').textContent = followingCount;
            document.getElementById('followersCount').textContent = followersCount;

            // Show user's tweets
            const userTweets = tweets.filter(tweet => tweet.author === currentUser);
            const profileTweets = document.getElementById('profileTweets');
            
            profileTweets.innerHTML = '';
            if (userTweets.length === 0) {
                profileTweets.innerHTML = '<div class="empty-state">No tweets yet</div>';
            } else {
                userTweets.forEach(tweet => {
                    const tweetElement = createTweetElement(tweet);
                    profileTweets.appendChild(tweetElement);
                });
            }
        }

        function updateExplore() {
            const exploreContent = document.getElementById('exploreContent');
            if (!currentUser) {
                exploreContent.classList.add('hidden');
                return;
            }

            exploreContent.classList.remove('hidden');
            
            const usersList = document.getElementById('usersList');
            const otherUsers = Object.keys(users).filter(username => username !== currentUser);
            
            usersList.innerHTML = '';
            if (otherUsers.length === 0) {
                usersList.innerHTML = '<div class="empty-state">No other users to discover</div>';
            } else {
                otherUsers.forEach(username => {
                    const user = users[username];
                    const isFollowing = follows[currentUser]?.includes(username) || false;
                    
                    const userDiv = document.createElement('div');
                    userDiv.className = 'profile-item';
                    userDiv.innerHTML = `
                        <div class="avatar">${user.displayName[0].toUpperCase()}</div>
                        <div style="flex: 1;">
                            <div class="username">${user.displayName}</div>
                            <div class="handle">@${user.username}</div>
                        </div>
                        <button class="btn follow-btn ${isFollowing ? 'btn-secondary' : ''}" data-username="${username}">
                            ${isFollowing ? 'Unfollow' : 'Follow'}
                        </button>
                    `;
                    
                    const followBtn = userDiv.querySelector('.follow-btn');
                    followBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleFollow(username);
                    });
                    
                    usersList.appendChild(userDiv);
                });
            }
        }

        function toggleFollow(username) {
            if (!follows[currentUser]) follows[currentUser] = [];
            
            const followIndex = follows[currentUser].indexOf(username);
            if (followIndex > -1) {
                follows[currentUser].splice(followIndex, 1);
            } else {
                follows[currentUser].push(username);
            }
            
            saveData();
            updateExplore();
            updateProfile();
        }

        function saveData() {
            localStorage.setItem('twitter_users', JSON.stringify(users));
            localStorage.setItem('twitter_tweets', JSON.stringify(tweets));
            localStorage.setItem('twitter_follows', JSON.stringify(follows));
            localStorage.setItem('twitter_likes', JSON.stringify(likes));
            localStorage.setItem('twitter_retweets', JSON.stringify(retweets));
        }

        function updateUI() {
            if (currentUser) {
                switchTab('timeline');
            }
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
